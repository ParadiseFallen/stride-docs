# Shadows
# Тени

<span class="label label-doc-level">Beginner</span>
<span class=
<span class="label label-doc-audience">Designer</span>
<span class=
<span class="label label-doc-audience">Artist</span>
<span class=

Shadows bring significant information and realism to a scene.
Тени привносят важную информацию и реализм в сцену.

| Shadows **off**                                          | Shadows **on**                                               |
|  Тени **выключены** |  Тени **на** |
| -------------------------------------------------------- | ------------------------------------------------------------ |
|  --------------------------------------------------  ------ |  --------------------------------------------------  ---------- |
| ![media/SceneNoShadows.png](media/SceneNoShadows.png)  | ![media/SceneWithShadows.png](media/SceneWithShadows.png) 
|  ![media/SceneNoShadows.png](media/SceneNoShadows.png) |  ![media/SceneWithShadows.png](media/SceneWithShadows.png)

Only [directional lights](directional-lights.md), [point lights](point-lights.md), and [spot lights](spot-lights.md) can cast shadows.
Только [направленные источники света](directional-lights.md), [точечные источники света](point-lights.md) и [прожекторы](spot-lights.md) могут отбрасывать тени.

## Shadow maps
## Карты теней

Stride uses **shadow mapping** to render shadows. To understand shadow maps, imagine a camera in the center of the sun, so you're looking down from the sun's perspective.
Stride использует **отображение теней** для рендеринга теней.  Чтобы понять карты теней, представьте себе камеру в центре солнца, так что вы смотрите вниз с точки зрения солнца.

![Light and shadow](media/light-and-shadow.png)
![Свет и тень](media/light-and-shadow.png)

Everything the sun sees is in light. Everything hidden from the sun (ie behind **occluders**) is in shadow.
Все, что видит солнце, находится в свете.  Все, что скрыто от солнца (т.е. за **окклюдерами**), находится в тени.

From this perspective, Stride creates a **shadow map** for each light that casts shadows. This tells us how far each visible pixel is from the light. When Stride renders the scene, it checks the position of each pixel in the shadow map to learn if it can be "seen" by the light. If the light can see the pixel, the light is illuminated. If it can't, the pixel is in shadow.
С этой точки зрения Stride создает **карту теней** для каждого источника света, отбрасывающего тени.  Это говорит нам, как далеко каждый видимый пиксель находится от света.  Когда Stride визуализирует сцену, он проверяет положение каждого пикселя на карте теней, чтобы узнать, можно ли его «увидеть» при свете.  Если свет может видеть пиксель, свет горит.  Если это невозможно, пиксель находится в тени.

For example, these are shadow maps from the first-person shooter sample included in Stride, generated by a [directional light](directional-lights.md).
Например, это карты теней из примера шутера от первого лица, включенного в Stride, сгенерированные с помощью [направленного света](directional-lights.md).

![FPS scene](media/fps-sample-scene.png)
![Сцена FPS](media/fps-sample-scene.png)

![FPS scene shadow map](media/shadow-atlas-2x.png)
![Карта теней сцены FPS](media/shadow-atlas-2x.png)

>[!Note]
>[!Примечание]
>Note that the directional light in the example above creates four shadow maps, one for each cascade. For more information, see the [Directional lights](directional-lights.md) page.
>Обратите внимание, что направленный свет в приведенном выше примере создает четыре карты теней, по одной для каждого каскада.  Для получения дополнительной информации см. страницу [Направленные огни](directional-lights.md).

### The shadow atlas
### Теневой атлас

Shadow maps for each light that casts a shadow are saved in a region of the **shadow atlas** texture. You can choose how much of the shadow atlas each light uses. The larger the shadow map, the better the shadow quality, but the less space you have for shadow maps from other light sources. 
Карты теней для каждого источника света, отбрасывающего тень, сохраняются в области текстуры **атласа теней**.  Вы можете выбрать, какую часть атласа теней использует каждый источник света.  Чем больше карта теней, тем лучше качество теней, но тем меньше места остается для карт теней от других источников света.

| Higher-quality shadow (uses a large area of the shadow atlas)    | Lower-quality shadow (uses a smaller area of the shadow atlas)  
|  Тень более высокого качества (используется большая область атласа теней) |  Тень более низкого качества (используется меньшая область атласа теней)
| ---------------------------------------------------------------- | ------------------------------------------------------------ 
|  --------------------------------------------------  -------------- |  --------------------------------------------------  ----------
| ![High-resolution shadow](media/shadow-high-resolution.png)      | ![Low-resolution shadow](media/shadow-low-resolution.png) 
|  ![Тень высокого разрешения](media/shadow-high-resolution.png) |  ![Тень низкого разрешения](media/shadow-low-resolution.png)
| ![FPS scene shadow map](media/shadow-atlas-2x.png)               | ![FPS scene shadow map](media/shadow-atlas-1x.png)
|  ![Карта теней сцены FPS](media/shadow-atlas-2x.png) |  ![Карта теней сцены FPS](media/shadow-atlas-1x.png)

Generally, you should give more space to light sources that cast the most visible shadows. 
Как правило, вы должны давать больше места источникам света, которые отбрасывают наиболее заметные тени.

The size of each area in the shadow map depends on several factors:
Размер каждой области на карте теней зависит от нескольких факторов:

* the `shadowMapSizeFactor` based on the `LightShadowMap.Size` property (/8, /4, /2, x1, or x2)
* `shadowMapSizeFactor`, основанный на свойстве `LightShadowMap.Size` (/8, /4, /2, x1 или x2)
* the projected size of the light in screenspace (`lightSize`)
* проецируемый размер света в пространстве экрана (`lightSize`)
  * for directional lights, the lightSize is equal to the max (screenWidth, screenHeight)
* для направленного света lightSize равен max (screenWidth, screenHeight)
  * for spot lights, the lightSize is equal to the projection of the projected sphere at the target spot light cone
* для прожекторов lightSize равен проекции спроецированной сферы на конус целевого прожектора
* the `ShadowMapBaseSize` equals `1024`
* `ShadowMapBaseSize` равно `1024`

The final size of the shadow map is calculated like this:
Окончательный размер карты теней рассчитывается так:

```cs
```CS
// Calculate the size factor
// Рассчитываем фактор размера
var shadowMapSizeFinalFactor = shadowImportanceFactor * shadowMapSizeFactor;
var shadowMapSizeFinalFactor = shadowImportanceFactor * shadowMapSizeFactor;
// Multiply the light projected size by the size factor
// Умножаем размер проецируемого света на коэффициент размера
var shadowMapSize = NextPowerOfTwo(lightSize * shadowSizeFinalFactor);
var shadowMapSize = NextPowerOfTwo (lightSize * shadowSizeFinalFactor);
// Clamp to a maximum size
// Зажим до максимального размера
shadowMapSize = min(shadowMapSize, ShadowMapBaseSize  * shadowSizeFinalFactor);
shadowMapSize = min(shadowMapSize, ShadowMapBaseSize * shadowSizeFinalFactor);
```
```

If you've enabled shadows on a light in your scene, but it isn't casting shadows, make sure there's enough space in the shadow atlas to create a shadow map for the light. For more information, see [Troubleshooting — Lights don't cast shadows](../../troubleshooting/lights-dont-cast-shadows.md).
Если вы включили тени для источника света в своей сцене, но он не отбрасывает тени, убедитесь, что в атласе теней достаточно места для создания карты теней для источника света.  Для получения дополнительной информации см. [Устранение неполадок — источники света не отбрасывают тени](../../troubleshooting/lights-dont-cast-shadows.md).

## See also
## Смотрите также

* [Point lights](point-lights.md)
* [Точечные огни](point-lights.md)
* [Directional lights](directional-lights.md)
* [Направленные огни](directional-lights.md)
* [Spot lights](spot-lights.md)
* [Прожектор](spot-lights.md)
* [Troubleshooting — Lights don't cast shadows](../../troubleshooting/lights-dont-cast-shadows.md)
* [Устранение неполадок — Свет не отбрасывает тени](../../troubleshooting/lights-dont-cast-shadows.md)
