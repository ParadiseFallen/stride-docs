# Аддитивная анимация

<span class="label label-doc-level">Сложность / Средняя</span>
<span class="label label-doc-audience">Область / Дизайн</span>

**Аддитивная анимация** - процесс объединения анимаций с использованием **разничных клипов** (также известен как **Аддитивные анимационные клипы**).

![Аддитивная анимация](media/animations-additive-sample.gif)

В приведенном выше примере самой левой анимации является анимация *Хотьбы*. Самая правая анимация - это анимация *Бездействия*. Две анимации в центре - это анимация *Хотьбы* и *Бездействия* соответственно, но в них добавлена анимация *Перезарядки*.

Это означает, что нам нужно было создать только три анимации: *Хотьба*, *Бездействие* и *Перезарядка*. Кроме того, мы можем добавить анимацию *Перезарядка* в другие подходящие анимации (например *Стрейф* или *Бег*). Это помогает сохранить бюджет памяти и количество анимации низким.

## Разничная анимация

**Разничная анимация** - разница между двумя анимационными клипами: **Источником**(S) и **Исходным**(R).

Возьмите анимацию *Перезарядки*, которую мы хотим добавить в другие анимационные клипы. Это наш **Источник** клипа(ов). Поскольку анимация *Перезарядки* в основном включает в себя оружие, она будет хорошо сочетаться с анимациями, которые не связаны с оружием (например, *Бездействие*, *Бег*). Мы можем использовать одну из этих анимаций - допустим, анимация *Бездействия* - как наш **Исходный** клип(ы).

Stride вычисляет разницу между источником и эталонной анимацией, чтобы создать **Разничную анимацию** (d).Разница анимации кодирует разницу между источником и эталонными клипами. Мы можем выразить это как d = s - R.

Мы можем использовать **Разничную анимацию** для смешивания источника и эталонной анимации. Мы также можем использовать тот же клип различий, чтобы смешать анимацию источника с **Другими** анимациями. Если анимация, в которую вы добавляете, достаточно похожа на оригинальный клип, то анимация эффективно смешивается. Например, вы можете использовать его, чтобы добавить анимацию *Перезарядки* в любую анимацию, которая не использует руки, таких как приседание.

>[!Note]
>Аддитивная анимация должна использовать ту же сетку и скелет.

### Создать клип разницы

1. В **Asset View** (внизу по умолчанию), нажимите **Add asset** и выберите **Animations > Animation**. Откроется диалогове окно.

2. Поскольку нам не нужен источник для этой анимации, нажмите **Cancel**.

    Game Studio спрашивает, хотите ли вы создать анимацию без исходного файла. 

    ![Создание анимации без исходного файла](media/create-animation-without-source-file.png)

3. Нажимите **Yes**. Game Studio добавит новый пустой ассет анимации в **Asset View**.

4. Дайте активу имя, которое позволяет его легко идентифицировать. Например, если вы хотите сделать анимацию перезарядки, которая может быть использована с другими анимациями, вы можете назвать актив *ReloadAdditive*.

5. В **Asset View** (нижняя панель по умолчанию), выберите созданный вами ассет анимации.

6. В **Property Grid** (справа по умолчанию), добавьте **Source** анимационный клип. Это анимация, которую вы хотите применить поверх других анимациий.

    ![Выберать исходный файл](media/animations-additive-animations-1.png)

     >[!Note]
     >Убедитесь, что вы добавите файл, который содержит саму анимацию (например, файл модели, такой как .fbx), **НЕ** ассет анимации, который ссылается на неё.Анимационные файлы обычно сохраняются в **Resources** папке.

7. Под **Type**, выбирите **Difference Clip**.

8. Под **Reference**, укажите анимацию, которую вы хотите использовать в качестве своего **reference clip**. Это анимация Stride ссылкается для создания различий.

    ![Выбор исходного файла](media/animations-additive-animations-2.png)

9. Выбрите **Mode** из выпадающего меню.

    * **Animation** создает разницу в клипе из всей анимации источника, ссылаясь на его кадр по кадру.
    * **FirstFrame** создает разницу в клипе только из первого кадра исходной анимации.

10. Далее к **Skeleton**, укажите скелет для различного клипа.

    ![Выбор скелета](media/animations-additive-animations-3.png)

    Это должен быть скелет, который работает для всех анимаций, которые вы хотите смешать с разностным клипом. В большинстве случаев вы должны использовать тот же скелет, который вы использовали для источника и исходной (эталонной) анимации.

11. Если Вы хотите [предпросмотр анимации](preview-animations.md) в окне предпросмотра,
укажите **Preview model** подходящую для анимации.

    ![Выбор режима игры](media/animations-additive-animations-4.png)

    >[!Note]
    >Предварительный просмотр ассетов показывает только ту анимацию источника, которую вы указываете в разнице.

## Используйте аддитивную анимацию

Вы можете использовать аддитивные анимации с анимацией, которые используют ту же скелет и сетку с кожей.

1. В **Asset View** (нижняя панель по умолчанию), нажмите **Add asset**.

2. Выберите **Scripts > Animation Start**.

    ![Старт анимации](media/animations-additive-animations-animation-start.png)

     *AnimationStart* это скрипт запуска, который вы можете использовать для загрузки анимации в свою модель, включая аддитивную анимацию. Для получения дополнительной информации см. [Скрипты анимации](animation-scripts.md).

3. Перекомпилируйте ваш проект, чтобы применить изменения.

4. В **scene view**, выберите сущность, которую хотите анимировать.

    ![Выбор сущщности](media/animations-use-3d-animations-select-entity.png)

    >[!Note]
    >Чтобы анимировать сущность, объект должен иметь компонент модели.

5. В **Property Grid** (справа по умолчанию), нажмите **Add component** и выберите **Animations**.

    ![Добавление компонента анимации](media/animations-use-3d-animations-add-animation-component.png)

    Game Studio добавит компонент анимации в сущность.

6. Нажмите **Add component** и выберите **Animation Start** скрипт.

    ![Добавление скрипта начала анимации](media/add-animation-start-script.png)

    Скрипт позволяет настроить список анимации, которые будут загружены в вашу сущность.

7. В **Animation Start** свойствах, рядом с **Animations**, нажмите ![зелёную кнопку добавления](~/manual/game-studio/media/green-plus-icon.png) (**Add**).

    ![Добавление анимации в список](media/add-animation-to-list.png)

8. Рядом с **Clip**, укажите **source** анимацию, которую вы использовали в разнице.

    ![Указание источника](media/specify-clip-1.png)

9. Рядом с **Add to Animations**, нажмите ![зелёную кнопку добавления](~/manual/game-studio/media/green-plus-icon.png) (**Add**).

10. Расскройте свойства анимации. Рядом с **Clip**, укажите **reference** анимацию, которую вы установили в разнице.

    ![Указание источника](media/specify-clip-2.png)

11. Под **Blend Operation**, выберите **Additive**.

    ![Указание источника](media/type-additive.png)

12. Повторите шаги, чтобы добавить столько анимаций, сколько вам нужно.

    ![Старт анимации](media/animations-additive-animations-start2.png)

## Смотрите так же

* [Импорт анимации](import-animations.md)
* [Свойства анимации](animation-properties.md)
* [Настройка анимации](set-up-animations.md)
* [Предпросмотр анимации](preview-animations.md)
* [Скрипты анимации](animation-scripts.md)
* [Аддитивная анимация](additive-animation.md)
* [Процедурная анимация](procedural-animation.md)
* [Пользовательские деревья смешивания](custom-blend-trees.md)
* [Связи узлов моделей](model-node-links.md)
* [Пользовательские аттрибуты](custom-attributes.md)