# Сборки ассеты

>[!Warning]
>Этот раздел устарел. На данный момент вы должны использовать его только для справки.

Пакет ассетов позволяет упаковать ассеты в единый архив, который можно загрузить в игру в определенное время.

Он позволяет создавать **Downloadable Content (DLC)**.

Основные правила:

- Проект может генерировать несколько пакетов.
- Пакет создается из нескольких **assets selectors** (в настоящее время поддерживаются только `PathSelector` и `TagSelector`)
- Пакет может иметь зависимости от других пакетов
- Каждый пакет неявно ссылается на пакет по умолчанию, где каждый актив, который не должен входить в определенный пакет, будет упакован.
- После развертывания пакета в игре становятся доступными все активы из этого пакета и все его зависимости.
- Разрешение пакета выполняется с помощью асинхронного обратного вызова, который позволяет загрузить пакет и будет вызываться один раз для каждой зависимости (аналогично событию AssemblyResolve).

# Создйтеь бандл

> [!Note]
> Создание в настоящее время требует некоторых ручных действий (например, редактирование `sdpkg` вручную).

Откройте файл `sdprj` исполняемого файла игры и добавьте следующую конфигурацию:

Пример:

- Пакет с именем `MyBundleName` будет включать активы с тегами `MyTag1` и `MyTag2`.
- Пакет с именем `MyBundleName2` будет включать активы с тегами `MyTag3` и `MyTag4`.  Этот пакет имеет зависимость от `MyBundleName`
- Существует также `PathSelector`, который следует соглашению о фильтрации `.gitignore`.

 

```cs
Bundles:
 - Name: MyBundleName
   Selectors:
    - !TagSelector
      Tags: 
        - MyTag1
        - MyTag2
 - Name: MyBundleName2
   Dependencies:
    - MyBundleName
   Selectors:
    - !TagSelector
      Tags: 
        - MyTag3
        - MyTag4
    - !PathSelector
      Paths:
        - folder1/
        - /folder2/
        - *.bin
        - folder3/*.xml
```

> [!Note]
> 
> Зависимости активов автоматически помещаются в наиболее подходящий пакет.
> 
> Текущий процесс работает следующим образом:
>
> — найти ресурсы, соответствующие определенным селекторам тегов («корни» ресурсов пакета).
> — Перечислите активы, которые зависят от этих «корневых» активов пакета, и поместите их в тот же пакет, что и их «корневой» актив.
> - За исключением случаев, когда он уже доступен через одну из зависимостей пакета (например, общий зависимый пакет или пакет по умолчанию).
> - Поместите все остальное в пакет по умолчанию.
>
> Обратите внимание, что:
> 
> - Общие активы могут быть продублированы, если они специально не помещены в общий пакет или пакет по умолчанию, но это предусмотрено (например, если пользователь хочет распространять 2 отдельных DLC, которым нужны общие активы, но которые должны быть автономными).
> - Каждый пакет неявно зависит от пакета по умолчанию.
>      
>

# Загрузить пакет во время выполнения

Загрузка пакета выполняется через `ObjectDatabase.LoadBundle(string bundleName) (ref:{Stride.Core.Storage.ObjectDatabase.LoadBundle})`:

```cs
// Load bundle
Assets.DatabaseFileProvider.ObjectDatabase.LoadBundle("MyBundleName2");
// Load specified asset
var texture = Assets.Load<Texture2D>("AssetContainedInMyBundleName2");
```

# Селекторы

 Селекторы помогают решить, какие активы хранятся в конкретном пакете.

## Селектор тегов

 Выберите активы на основе списка тегов, прикрепленных к каждому активу.

Характеристики:

- Теги: список тегов.  Будет включен любой актив, который содержит хотя бы один из тегов.

## Селектор пути

Выберите активы на основе их пути.

Поддерживаются стандартные шаблоны .gitignore (кроме ! (negate), # (комментарии) и \[0-9\] (группы)).

Характеристики:

- Пути: Список фильтров.  Будет включен любой ресурс, URL-адрес которого соответствует одному из фильтров.
